 Uploaded in 7.3s. Compression took 4.0s
==> Build successful ðŸŽ‰
==> Setting WEB_CONCURRENCY=1 by default, based on available CPUs in the instance
==> Deploying...
==> Running 'yarn start'
yarn run v1.22.22
$ NODE_ENV=production node dist/index.cjs
/opt/render/project/src/dist/index.cjs:73
${Gu(t)}`);return{...R,id:I,type:F,function:{...ne,name:Y,arguments:Q}}})}}:{...f,message:{..._,content:h,role:w,refusal:c.refusal??null},finish_reason:u,index:p,logprobs:d}}),created:i,model:s,object:"chat.completion",...a?{system_fingerprint:a}:{}};return OE(l,e)}function Gu(t){return JSON.stringify(t)}var yc=class t extends gi{static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static runTools(e,r,n){let i=new t(r),s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,r,s)),i}};var qr=class extends A{constructor(){super(...arguments),this.messages=new mi(this._client)}create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}retrieve(e,r){return this._client.get(S`/chat/completions/${e}`,r)}update(e,r,n){return this._client.post(S`/chat/completions/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/chat/completions",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/chat/completions/${e}`,r)}parse(e,r){return jE(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>dc(n,e))}runTools(e,r){return e.stream?yc.runTools(this._client,e,r):vc.runTools(this._client,e,r)}stream(e,r){return gi.createChatCompletion(this._client,e,r)}};qr.Messages=mi;var fn=class extends A{constructor(){super(...arguments),this.completions=new qr(this._client)}};fn.Completions=qr;var BE=Symbol("brand.privateNullableHeaders");function*P$(t){if(!t)return;if(BE in t){let{values:n,nulls:i}=t;yield*n.entries();for(let s of i)yield[s,null];return}let e=!1,r;t instanceof Headers?r=t.entries():Rg(t)?r=t:(e=!0,r=Object.entries(t??{}));for(let n of r){let i=n[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");let s=Rg(n[1])?n[1]:[n[1]],a=!1;for(let o of s)o!==void 0&&(e&&!a&&(a=!0,yield[i,null]),yield[i,o])}}var O=t=>{let e=new Headers,r=new Set;for(let n of t){let i=new Set;for(let[s,a]of P$(n)){let o=s.toLowerCase();i.has(o)||(e.delete(s),i.add(o)),a===null?(e.delete(s),r.add(o)):(e.append(s,a),r.delete(o))}}return{[BE]:!0,values:e,nulls:r}};var na=class extends A{create(e,r){return this._client.post("/audio/speech",{body:e,...r,headers:O([{Accept:"application/octet-stream"},r?.headers]),__binaryResponse:!0})}};var ia=class extends A{create(e,r){return this._client.post("/audio/transcriptions",Ct({body:e,...r,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};var sa=class extends A{create(e,r){return this._client.post("/audio/translations",Ct({body:e,...r,__metadata:{model:e.model}},this._client))}};var vr=class extends A{constructor(){super(...arguments),this.transcriptions=new ia(this._client),this.translations=new sa(this._client),this.speech=new na(this._client)}};vr.Transcriptions=ia;vr.Translations=sa;vr.Speech=na;var vi=class extends A{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(S`/batches/${e}`,r)}list(e={},r){return this._client.getAPIList("/batches",X,{query:e,...r})}cancel(e,r){return this._client.post(S`/batches/${e}/cancel`,r)}};var aa=class extends A{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(S`/assistants/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(S`/assistants/${e}`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/assistants",X,{query:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(S`/assistants/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var oa=class extends A{create(e,r){return this._client.post("/realtime/sessions",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var ca=class extends A{create(e,r){return this._client.post("/realtime/transcription_sessions",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var mn=class extends A{constructor(){super(...arguments),this.sessions=new oa(this._client),this.transcriptionSessions=new ca(this._client)}};mn.Sessions=oa;mn.TranscriptionSessions=ca;var la=class extends A{create(e,r){return this._client.post("/chatkit/sessions",{body:e,...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}cancel(e,r){return this._client.post(S`/chatkit/sessions/${e}/cancel`,{...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}};var ua=class extends A{retrieve(e,r){return this._client.get(S`/chatkit/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}list(e={},r){return this._client.getAPIList("/chatkit/threads",Nr,{query:e,...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}delete(e,r){return this._client.delete(S`/chatkit/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}listItems(e,r={},n){return this._client.getAPIList(S`/chatkit/threads/${e}/items`,Nr,{query:r,...n,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}};var hn=class extends A{constructor(){super(...arguments),this.sessions=new la(this._client),this.threads=new ua(this._client)}};hn.Sessions=la;hn.Threads=ua;var pa=class extends A{create(e,r,n){return this._client.post(S`/threads/${e}/messages`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{thread_id:i}=r;return this._client.get(S`/threads/${i}/messages/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:i,...s}=r;return this._client.post(S`/threads/${i}/messages/${e}`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(S`/threads/${e}/messages`,X,{query:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{thread_id:i}=r;return this._client.delete(S`/threads/${i}/messages/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var da=class extends A{retrieve(e,r,n){let{thread_id:i,run_id:s,...a}=r;return this._client.get(S`/threads/${i}/runs/${s}/steps/${e}`,{query:a,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r,n){let{thread_id:i,...s}=r;return this._client.getAPIList(S`/threads/${i}/runs/${e}/steps`,X,{query:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var LE=t=>{if(typeof Buffer<"u"){let e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(t),r=e.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e.charCodeAt(i);return Array.from(new Float32Array(n.buffer))}};var gn=t=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[t]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(t)?.trim()};var Je,xi,fv,yr,Ju,Vt,bi,fa,yi,Yu,Tt,Xu,Zu,wc,xc,bc,zE,UE,QE,HE,KE,VE,WE,Mr=class extends pn{constructor(){super(...arguments),Je.add(this),fv.set(this,[]),yr.set(this,{}),Ju.set(this,{}),Vt.set(this,void 0),bi.set(this,void 0),fa.set(this,void 0),yi.set(this,void 0),Yu.set(this,void 0),Tt.set(this,void 0),Xu.set(this,void 0),Zu.set(this,void 0),wc.set(this,void 0)}[(fv=new WeakMap,yr=new WeakMap,Ju=new WeakMap,Vt=new WeakMap,bi=new WeakMap,fa=new WeakMap,yi=new WeakMap,Yu=new WeakMap,Tt=new WeakMap,Xu=new WeakMap,Zu=new WeakMap,wc=new WeakMap,Je=new WeakSet,Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",i=>{let s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,a)=>r.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let r=new xi;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let i=hr.fromReadableStream(e,this.controller);for await(let s of i)b(this,Je,"m",xc).call(this,s);if(i.controller.signal?.aborted)throw new $e;return this._addRun(b(this,Je,"m",bc).call(this))}toReadableStream(){return new hr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,i){let s=new xi;return s._run(()=>s._runToolAssistantStream(e,r,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(e,r,n,i){let s=i?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.submitToolOutputs(r,a,{...i,signal:this.controller.signal});this._connected();for await(let l of o)b(this,Je,"m",xc).call(this,l);if(o.controller.signal?.aborted)throw new $e;return this._addRun(b(this,Je,"m",bc).call(this))}static createThreadAssistantStream(e,r,n){let i=new xi;return i._run(()=>i._threadAssistantStream(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,r,n,i){let s=new xi;return s._run(()=>s._runAssistantStream(e,r,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return b(this,Xu,"f")}currentRun(){return b(this,Zu,"f")}currentMessageSnapshot(){return b(this,Vt,"f")}currentRunStepSnapshot(){return b(this,wc,"f")}async finalRunSteps(){return await this.done(),Object.values(b(this,yr,"f"))}async finalMessages(){return await this.done(),Object.values(b(this,Ju,"f"))}async finalRun(){if(await this.done(),!b(this,bi,"f"))throw Error("Final run was not received.");return b(this,bi,"f")}async _createThreadAssistantStream(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let s={...r,stream:!0},a=await e.createAndRun(s,{...n,signal:this.controller.signal});this._connected();for await(let o of a)b(this,Je,"m",xc).call(this,o);if(a.controller.signal?.aborted)throw new $e;return this._addRun(b(this,Je,"m",bc).call(this))}async _createAssistantStream(e,r,n,i){let s=i?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(r,a,{...i,signal:this.controller.signal});this._connected();for await(let l of o)b(this,Je,"m",xc).call(this,l);if(o.controller.signal?.aborted)throw new $e;return this._addRun(b(this,Je,"m",bc).call(this))}static accumulateDelta(e,r){for(let[n,i]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=i;continue}let s=e[n];if(s==null){e[n]=i;continue}if(n==="index"||n==="type"){e[n]=i;continue}if(typeof s=="string"&&typeof i=="string")s+=i;else if(typeof s=="number"&&typeof i=="number")s+=i;else if(nc(s)&&nc(i))s=this.accumulateDelta(s,i);else if(Array.isArray(s)&&Array.isArray(i)){if(s.every(a=>typeof a=="string"||typeof a=="number")){s.push(...i);continue}for(let a of i){if(!nc(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let l=s[o];l==null?s.push(a):s[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${i}, accValue: ${s}`);e[n]=s}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,i){return await this._createAssistantStream(r,e,n,i)}async _runToolAssistantStream(e,r,n,i){return await this._createToolAssistantStream(r,e,n,i)}};xi=Mr,xc=function(e){if(!this.ended)switch(U(this,Xu,e,"f"),b(this,Je,"m",QE).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":b(this,Je,"m",WE).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":b(this,Je,"m",UE).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":b(this,Je,"m",zE).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},bc=function(){if(this.ended)throw new M("stream has ended, this shouldn't happen");if(!b(this,bi,"f"))throw Error("Final run has not been received");return b(this,bi,"f")},zE=function(e){let[r,n]=b(this,Je,"m",KE).call(this,e,b(this,Vt,"f"));U(this,Vt,r,"f"),b(this,Ju,"f")[r.id]=r;for(let i of n){let s=r.content[i.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(let i of e.data.delta.content){if(i.type=="text"&&i.text){let s=i.text,a=r.content[i.index];if(a&&a.type=="text")this._emit("textDelta",s,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=b(this,fa,"f")){if(b(this,yi,"f"))switch(b(this,yi,"f").type){case"text":this._emit("textDone",b(this,yi,"f").text,b(this,Vt,"f"));break;case"image_file":this._emit("imageFileDone",b(this,yi,"f").image_file,b(this,Vt,"f"));break}U(this,fa,i.index,"f")}U(this,yi,r.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(b(this,fa,"f")!==void 0){let i=e.data.content[b(this,fa,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,b(this,Vt,"f"));break;case"text":this._emit("textDone",i.text,b(this,Vt,"f"));break}}b(this,Vt,"f")&&this._emit("messageDone",e.data),U(this,Vt,void 0,"f")}},UE=function(e){let r=b(this,Je,"m",HE).call(this,e);switch(U(this,wc,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(let s of n.step_details.tool_calls)s.index==b(this,Yu,"f")?this._emit("toolCallDelta",s,r.step_details.tool_calls[s.index]):(b(this,Tt,"f")&&this._emit("toolCallDone",b(this,Tt,"f")),U(this,Yu,s.index,"f"),U(this,Tt,r.step_details.tool_calls[s.index],"f"),b(this,Tt,"f")&&this._emit("toolCallCreated",b(this,Tt,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":U(this,wc,void 0,"f"),e.data.step_details.type=="tool_calls"&&b(this,Tt,"f")&&(this._emit("toolCallDone",b(this,Tt,"f")),U(this,Tt,void 0,"f")),this._emit("runStepDone",e.data,r);break;case"thread.run.step.in_progress":break}},QE=function(e){b(this,fv,"f").push(e),this._emit("event",e)},HE=function(e){switch(e.event){case"thread.run.step.created":return b(this,yr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=b(this,yr,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let i=xi.accumulateDelta(r,n.delta);b(this,yr,"f")[e.data.id]=i}return b(this,yr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":b(this,yr,"f")[e.data.id]=e.data;break}if(b(this,yr,"f")[e.data.id])return b(this,yr,"f")[e.data.id];throw new Error("No snapshot available")},KE=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(let s of i.delta.content)if(s.index in r.content){let a=r.content[s.index];r.content[s.index]=b(this,Je,"m",VE).call(this,s,a)}else r.content[s.index]=s,n.push(s);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},VE=function(e,r){return xi.accumulateDelta(r,e)},WE=function(e){switch(U(this,Zu,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":U(this,bi,e.data,"f"),b(this,Tt,"f")&&(this._emit("toolCallDone",b(this,Tt,"f")),U(this,Tt,void 0,"f"));break;case"thread.run.cancelling":break}};var wi=class extends A{constructor(){super(...arguments),this.steps=new da(this._client)}create(e,r,n){let{include:i,...s}=r;return this._client.post(S`/threads/${e}/runs`,{query:{include:i},body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}retrieve(e,r,n){let{thread_id:i}=r;return this._client.get(S`/threads/${i}/runs/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:i,...s}=r;return this._client.post(S`/threads/${i}/runs/${e}`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(S`/threads/${e}/runs`,X,{query:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{thread_id:i}=r;return this._client.post(S`/threads/${i}/runs/${e}/cancel`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r,n);return await this.poll(i.id,{thread_id:e},n)}createAndStream(e,r,n){return Mr.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){let i=O([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:a}=await this.retrieve(e,r,{...n,headers:{...n?.headers,...i}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await fr(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,r,n){return Mr.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n){let{thread_id:i,...s}=r;return this._client.post(S`/threads/${i}/runs/${e}/submit_tool_outputs`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}async submitToolOutputsAndPoll(e,r,n){let i=await this.submitToolOutputs(e,r,n);return await this.poll(i.id,r,n)}submitToolOutputsStream(e,r,n){return Mr.createToolAssistantStream(e,this._client.beta.threads.runs,r,n)}};wi.Steps=da;var vn=class extends A{constructor(){super(...arguments),this.runs=new wi(this._client),this.messages=new pa(this._client)}create(e={},r){return this._client.post("/threads",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(S`/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(S`/threads/${e}`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r){return this._client.delete(S`/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,r){let n=await this.createAndRun(e,r);return await this.runs.poll(n.id,{thread_id:n.thread_id},r)}createAndRunStream(e,r){return Mr.createThreadAssistantStream(e,this._client.beta.threads,r)}};vn.Runs=wi;vn.Messages=pa;var Wt=class extends A{constructor(){super(...arguments),this.realtime=new mn(this._client),this.chatkit=new hn(this._client),this.assistants=new aa(this._client),this.threads=new vn(this._client)}};Wt.Realtime=mn;Wt.ChatKit=hn;Wt.Assistants=aa;Wt.Threads=vn;var _i=class extends A{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}};var ma=class extends A{retrieve(e,r,n){let{container_id:i}=r;return this._client.get(S`/containers/${i}/files/${e}/content`,{...n,headers:O([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}};var Si=class extends A{constructor(){super(...arguments),this.content=new ma(this._client)}create(e,r,n){return this._client.post(S`/containers/${e}/files`,Ct({body:r,...n},this._client))}retrieve(e,r,n){let{container_id:i}=r;return this._client.get(S`/containers/${i}/files/${e}`,n)}list(e,r={},n){return this._client.getAPIList(S`/containers/${e}/files`,X,{query:r,...n})}delete(e,r,n){let{container_id:i}=r;return this._client.delete(S`/containers/${i}/files/${e}`,{...n,headers:O([{Accept:"*/*"},n?.headers])})}};Si.Content=ma;var yn=class extends A{constructor(){super(...arguments),this.files=new Si(this._client)}create(e,r){return this._client.post("/containers",{body:e,...r})}retrieve(e,r){return this._client.get(S`/containers/${e}`,r)}list(e={},r){return this._client.getAPIList("/containers",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/containers/${e}`,{...r,headers:O([{Accept:"*/*"},r?.headers])})}};yn.Files=Si;var ha=class extends A{create(e,r,n){let{include:i,...s}=r;return this._client.post(S`/conversations/${e}/items`,{query:{include:i},body:s,...n})}retrieve(e,r,n){let{conversation_id:i,...s}=r;return this._client.get(S`/conversations/${i}/items/${e}`,{query:s,...n})}list(e,r={},n){return this._client.getAPIList(S`/conversations/${e}/items`,Nr,{query:r,...n})}delete(e,r,n){let{conversation_id:i}=r;return this._client.delete(S`/conversations/${i}/items/${e}`,n)}};var xn=class extends A{constructor(){super(...arguments),this.items=new ha(this._client)}create(e={},r){return this._client.post("/conversations",{body:e,...r})}retrieve(e,r){return this._client.get(S`/conversations/${e}`,r)}update(e,r,n){return this._client.post(S`/conversations/${e}`,{body:r,...n})}delete(e,r){return this._client.delete(S`/conversations/${e}`,r)}};xn.Items=ha;var ki=class extends A{create(e,r){let n=!!e.encoding_format,i=n?e.encoding_format:"base64";n&&Re(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let s=this._client.post("/embeddings",{body:{...e,encoding_format:i},...r});return n?s:(Re(this._client).debug("embeddings/decoding base64 embeddings from base64"),s._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{let l=o.embedding;o.embedding=LE(l)}),a)))}};var ga=class extends A{retrieve(e,r,n){let{eval_id:i,run_id:s}=r;return this._client.get(S`/evals/${i}/runs/${s}/output_items/${e}`,n)}list(e,r,n){let{eval_id:i,...s}=r;return this._client.getAPIList(S`/evals/${i}/runs/${e}/output_items`,X,{query:s,...n})}};var Ai=class extends A{constructor(){super(...arguments),this.outputItems=new ga(this._client)}create(e,r,n){return this._client.post(S`/evals/${e}/runs`,{body:r,...n})}retrieve(e,r,n){let{eval_id:i}=r;return this._client.get(S`/evals/${i}/runs/${e}`,n)}list(e,r={},n){return this._client.getAPIList(S`/evals/${e}/runs`,X,{query:r,...n})}delete(e,r,n){let{eval_id:i}=r;return this._client.delete(S`/evals/${i}/runs/${e}`,n)}cancel(e,r,n){let{eval_id:i}=r;return this._client.post(S`/evals/${i}/runs/${e}`,n)}};Ai.OutputItems=ga;var bn=class extends A{constructor(){super(...arguments),this.runs=new Ai(this._client)}create(e,r){return this._client.post("/evals",{body:e,...r})}retrieve(e,r){return this._client.get(S`/evals/${e}`,r)}update(e,r,n){return this._client.post(S`/evals/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/evals",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/evals/${e}`,r)}};bn.Runs=Ai;var Ei=class extends A{create(e,r){return this._client.post("/files",Ct({body:e,...r},this._client))}retrieve(e,r){return this._client.get(S`/files/${e}`,r)}list(e={},r){return this._client.getAPIList("/files",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/files/${e}`,r)}content(e,r){return this._client.get(S`/files/${e}/content`,{...r,headers:O([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=1800*1e3}={}){let i=new Set(["processed","error","deleted"]),s=Date.now(),a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await fr(r),a=await this.retrieve(e),Date.now()-s>n)throw new ln({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}};var va=class extends A{};var ya=class extends A{run(e,r){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...r})}validate(e,r){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...r})}};var Ci=class extends A{constructor(){super(...arguments),this.graders=new ya(this._client)}};Ci.Graders=ya;var xa=class extends A{create(e,r,n){return this._client.getAPIList(S`/fine_tuning/checkpoints/${e}/permissions`,gr,{body:r,method:"post",...n})}retrieve(e,r={},n){return this._client.get(S`/fine_tuning/checkpoints/${e}/permissions`,{query:r,...n})}delete(e,r,n){let{fine_tuned_model_checkpoint:i}=r;return this._client.delete(S`/fine_tuning/checkpoints/${i}/permissions/${e}`,n)}};var Ti=class extends A{constructor(){super(...arguments),this.permissions=new xa(this._client)}};Ti.Permissions=xa;var ba=class extends A{list(e,r={},n){return this._client.getAPIList(S`/fine_tuning/jobs/${e}/checkpoints`,X,{query:r,...n})}};var Pi=class extends A{constructor(){super(...arguments),this.checkpoints=new ba(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(S`/fine_tuning/jobs/${e}`,r)}list(e={},r){return this._client.getAPIList("/fine_tuning/jobs",X,{query:e,...r})}cancel(e,r){return this._client.post(S`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return this._client.getAPIList(S`/fine_tuning/jobs/${e}/events`,X,{query:r,...n})}pause(e,r){return this._client.post(S`/fine_tuning/jobs/${e}/pause`,r)}resume(e,r){return this._client.post(S`/fine_tuning/jobs/${e}/resume`,r)}};Pi.Checkpoints=ba;var Gt=class extends A{constructor(){super(...arguments),this.methods=new va(this._client),this.jobs=new Pi(this._client),this.checkpoints=new Ti(this._client),this.alpha=new Ci(this._client)}};Gt.Methods=va;Gt.Jobs=Pi;Gt.Checkpoints=Ti;Gt.Alpha=Ci;var wa=class extends A{};var wn=class extends A{constructor(){super(...arguments),this.graderModels=new wa(this._client)}};wn.GraderModels=wa;var Ii=class extends A{createVariation(e,r){return this._client.post("/images/variations",Ct({body:e,...r},this._client))}edit(e,r){return this._client.post("/images/edits",Ct({body:e,...r,stream:e.stream??!1},this._client))}generate(e,r){return this._client.post("/images/generations",{body:e,...r,stream:e.stream??!1})}};var Oi=class extends A{retrieve(e,r){return this._client.get(S`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",gr,e)}delete(e,r){return this._client.delete(S`/models/${e}`,r)}};var Ni=class extends A{create(e,r){return this._client.post("/moderations",{body:e,...r})}};var _a=class extends A{accept(e,r,n){return this._client.post(S`/realtime/calls/${e}/accept`,{body:r,...n,headers:O([{Accept:"*/*"},n?.headers])})}hangup(e,r){return this._client.post(S`/realtime/calls/${e}/hangup`,{...r,headers:O([{Accept:"*/*"},r?.headers])})}refer(e,r,n){return this._client.post(S`/realtime/calls/${e}/refer`,{body:r,...n,headers:O([{Accept:"*/*"},n?.headers])})}reject(e,r={},n){return this._client.post(S`/realtime/calls/${e}/reject`,{body:r,...n,headers:O([{Accept:"*/*"},n?.headers])})}};var Sa=class extends A{create(e,r){return this._client.post("/realtime/client_secrets",{body:e,...r})}};var $r=class extends A{constructor(){super(...arguments),this.clientSecrets=new Sa(this._client),this.calls=new _a(this._client)}};$r.ClientSecrets=Sa;$r.Calls=_a;function GE(t,e){return!e||!aD(e)?{...t,output_parsed:null,output:t.output.map(r=>r.type==="function_call"?{...r,parsed_arguments:null}:r.type==="message"?{...r,content:r.content.map(n=>({...n,parsed:null}))}:r)}:mv(t,e)}function mv(t,e){let r=t.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:lD(e,i)};if(i.type==="message"){let s=i.content.map(a=>a.type==="output_text"?{...a,parsed:sD(e,a.text)}:a);return{...i,content:s}}return i}),n=Object.assign({},t,{output:r});return Object.getOwnPropertyDescriptor(t,"output_text")||ep(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let i of n.output)if(i.type==="message"){for(let s of i.content)if(s.type==="output_text"&&s.parsed!==null)return s.parsed}return null}}),n}function sD(t,e){return t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(e):JSON.parse(e)}function aD(t){return!!pc(t.text?.format)}function oD(t){return t?.$brand==="auto-parseable-tool"}function cD(t,e){return t.find(r=>r.type==="function"&&r.name===e)}function lD(t,e){let r=cD(t.tools??[],e.name);return{...e,...e,parsed_arguments:oD(r)?r.$parseRaw(e.arguments):r?.strict?JSON.parse(e.arguments):null}}function ep(t){let e=[];for(let r of t.output)if(r.type==="message")for(let n of r.content)n.type==="output_text"&&e.push(n.text);t.output_text=e.join("")}var ka,tp,_n,rp,JE,XE,ZE,YE,np=class t extends pn{constructor(e){super(),ka.add(this),tp.set(this,void 0),_n.set(this,void 0),rp.set(this,void 0),U(this,tp,e,"f")}static createResponse(e,r,n){let i=new t(r);return i._run(()=>i._createOrRetrieveResponse(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),b(this,ka,"m",JE).call(this);let s,a=null;"response_id"in r?(s=await e.responses.retrieve(r.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=r.starting_after??null):s=await e.responses.create({...r,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let o of s)b(this,ka,"m",XE).call(this,o,a);if(s.controller.signal?.aborted)throw new $e;return b(this,ka,"m",ZE).call(this)}[(tp=new WeakMap,_n=new WeakMap,rp=new WeakMap,ka=new WeakSet,JE=function(){this.ended||U(this,_n,void 0,"f")},XE=function(r,n){if(this.ended)return;let i=(a,o)=>{(n==null||o.sequence_number>n)&&this._emit(a,o)},s=b(this,ka,"m",YE).call(this,r);switch(i("event",r),r.type){case"response.output_text.delta":{let a=s.output[r.output_index];if(!a)throw new M(`missing output at index ${r.output_index}`);if(a.type==="message"){let o=a.content[r.content_index];if(!o)throw new M(`missing content at index ${r.content_index}`);if(o.type!=="output_text")throw new M(`expected content to be 'output_text', got ${o.type}`);i("response.output_text.delta",{...r,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let a=s.output[r.output_index];if(!a)throw new M(`missing output at index ${r.output_index}`);a.type==="function_call"&&i("response.function_call_arguments.delta",{...r,snapshot:a.arguments});break}default:i(r.type,r);break}},ZE=function(){if(this.ended)throw new M("stream has ended, this shouldn't happen");let r=b(this,_n,"f");if(!r)throw new M("request ended without sending any events");U(this,_n,void 0,"f");let n=uD(r,b(this,tp,"f"));return U(this,rp,n,"f"),n},YE=function(r){let n=b(this,_n,"f");if(!n){if(r.type!=="response.created")throw new M(`When snapshot hasn't been set yet, expected 'response.created' event, got ${r.type}`);return n=U(this,_n,r.response,"f"),n}switch(r.type){case"response.output_item.added":{n.output.push(r.item);break}case"response.content_part.added":{let i=n.output[r.output_index];if(!i)throw new M(`missing output at index ${r.output_index}`);let s=i.type,a=r.part;s==="message"&&a.type!=="reasoning_text"?i.content.push(a):s==="reasoning"&&a.type==="reasoning_text"&&(i.content||(i.content=[]),i.content.push(a));break}case"response.output_text.delta":{let i=n.output[r.output_index];if(!i)throw new M(`missing output at index ${r.output_index}`);if(i.type==="message"){let s=i.content[r.content_index];if(!s)throw new M(`missing content at index ${r.content_index}`);if(s.type!=="output_text")throw new M(`expected content to be 'output_text', got ${s.type}`);s.text+=r.delta}break}case"response.function_call_arguments.delta":{let i=n.output[r.output_index];if(!i)throw new M(`missing output at index ${r.output_index}`);i.type==="function_call"&&(i.arguments+=r.delta);break}case"response.reasoning_text.delta":{let i=n.output[r.output_index];if(!i)throw new M(`missing output at index ${r.output_index}`);if(i.type==="reasoning"){let s=i.content?.[r.content_index];if(!s)throw new M(`missing content at index ${r.content_index}`);if(s.type!=="reasoning_text")throw new M(`expected content to be 'reasoning_text', got ${s.type}`);s.text+=r.delta}break}case"response.completed":{U(this,_n,r.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",i=>{let s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,a)=>r.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=b(this,rp,"f");if(!e)throw new M("stream ended without producing a ChatCompletion");return e}};function uD(t,e){return GE(t,e)}var Aa=class extends A{list(e,r={},n){return this._client.getAPIList(S`/responses/${e}/input_items`,X,{query:r,...n})}};var Ea=class extends A{count(e={},r){return this._client.post("/responses/input_tokens",{body:e,...r})}};var Dr=class extends A{constructor(){super(...arguments),this.inputItems=new Aa(this._client),this.inputTokens=new Ea(this._client)}create(e,r){return this._client.post("/responses",{body:e,...r,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&ep(n),n))}retrieve(e,r={},n){return this._client.get(S`/responses/${e}`,{query:r,...n,stream:r?.stream??!1})._thenUnwrap(i=>("object"in i&&i.object==="response"&&ep(i),i))}delete(e,r){return this._client.delete(S`/responses/${e}`,{...r,headers:O([{Accept:"*/*"},r?.headers])})}parse(e,r){return this._client.responses.create(e,r)._thenUnwrap(n=>mv(n,e))}stream(e,r){return np.createResponse(this._client,e,r)}cancel(e,r){return this._client.post(S`/responses/${e}/cancel`,r)}compact(e,r){return this._client.post("/responses/compact",{body:e,...r})}};Dr.InputItems=Aa;Dr.InputTokens=Ea;var Ca=class extends A{create(e,r,n){return this._client.post(S`/uploads/${e}/parts`,Ct({body:r,...n},this._client))}};var Sn=class extends A{constructor(){super(...arguments),this.parts=new Ca(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(S`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(S`/uploads/${e}/complete`,{body:r,...n})}};Sn.Parts=Ca;var e4=async t=>{let e=await Promise.allSettled(t),r=e.filter(i=>i.status==="rejected");if(r.length){for(let i of r)console.error(i.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let i of e)i.status==="fulfilled"&&n.push(i.value);return n};var Ta=class extends A{create(e,r,n){return this._client.post(S`/vector_stores/${e}/file_batches`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:i}=r;return this._client.get(S`/vector_stores/${i}/file_batches/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{vector_store_id:i}=r;return this._client.post(S`/vector_stores/${i}/file_batches/${e}/cancel`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r);return await this.poll(e,i.id,n)}listFiles(e,r,n){let{vector_store_id:i,...s}=r;return this._client.getAPIList(S`/vector_stores/${i}/file_batches/${e}/files`,X,{query:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,r,n){let i=O([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:a}=await this.retrieve(r,{vector_store_id:e},{...n,headers:i}).withResponse();switch(s.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await fr(o);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},i){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let s=i?.maxConcurrency??5,a=Math.min(s,r.length),o=this._client,l=r.values(),c=[...n];async function u(d){for(let f of d){let h=await o.files.create({file:f,purpose:"assistants"},i);c.push(h.id)}}let p=Array(a).fill(l).map(u);return await e4(p),await this.createAndPoll(e,{file_ids:c})}};var Pa=class extends A{create(e,r,n){return this._client.post(S`/vector_stores/${e}/files`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:i}=r;return this._client.get(S`/vector_stores/${i}/files/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{vector_store_id:i,...s}=r;return this._client.post(S`/vector_stores/${i}/files/${e}`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(S`/vector_stores/${e}/files`,X,{query:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{vector_store_id:i}=r;return this._client.delete(S`/vector_stores/${i}/files/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r,n);return await this.poll(e,i.id,n)}async poll(e,r,n){let i=O([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let s=await this.retrieve(r,{vector_store_id:e},{...n,headers:i}).withResponse(),a=s.data;switch(a.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=s.response.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await fr(o);break;case"failed":case"completed":return a}}}async upload(e,r,n){let i=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:i.id},n)}async uploadAndPoll(e,r,n){let i=await this.upload(e,r,n);return await this.poll(e,i.id,n)}content(e,r,n){let{vector_store_id:i}=r;return this._client.getAPIList(S`/vector_stores/${i}/files/${e}/content`,gr,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var Fr=class extends A{constructor(){super(...arguments),this.files=new Pa(this._client),this.fileBatches=new Ta(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(S`/vector_stores/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(S`/vector_stores/${e}`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/vector_stores",X,{query:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(S`/vector_stores/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}search(e,r,n){return this._client.getAPIList(S`/vector_stores/${e}/search`,gr,{body:r,method:"post",...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};Fr.Files=Pa;Fr.FileBatches=Ta;var Ri=class extends A{create(e,r){return this._client.post("/videos",Jg({body:e,...r},this._client))}retrieve(e,r){return this._client.get(S`/videos/${e}`,r)}list(e={},r){return this._client.getAPIList("/videos",Nr,{query:e,...r})}delete(e,r){return this._client.delete(S`/videos/${e}`,r)}downloadContent(e,r={},n){return this._client.get(S`/videos/${e}/content`,{query:r,...n,headers:O([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(e,r,n){return this._client.post(S`/videos/${e}/remix`,Jg({body:r,...n},this._client))}};var Ia,t4,ip,ji=class extends A{constructor(){super(...arguments),Ia.add(this)}async unwrap(e,r,n=this._client.webhookSecret,i=300){return await this.verifySignature(e,r,n,i),JSON.parse(e)}async verifySignature(e,r,n=this._client.webhookSecret,i=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");b(this,Ia,"m",t4).call(this,n);let s=O([r]).values,a=b(this,Ia,"m",ip).call(this,s,"webhook-signature"),o=b(this,Ia,"m",ip).call(this,s,"webhook-timestamp"),l=b(this,Ia,"m",ip).call(this,s,"webhook-id"),c=parseInt(o,10);if(isNaN(c))throw new dr("Invalid webhook timestamp format");let u=Math.floor(Date.now()/1e3);if(u-c>i)throw new dr("Webhook timestamp is too old");if(c>u+i)throw new dr("Webhook timestamp is too new");let p=a.split(" ").map(m=>m.startsWith("v1,")?m.substring(3):m),d=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),f=l?`${l}.${o}.${e}`:`${o}.${e}`,h=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let m of p)try{let x=Buffer.from(m,"base64");if(await crypto.subtle.verify("HMAC",h,x,new TextEncoder().encode(f)))return}catch{continue}throw new dr("The given webhook signature does not match the expected signature")}};Ia=new WeakSet,t4=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},ip=function(e,r){if(!e)throw new Error("Headers are required");let n=e.get(r);if(n==null)throw new Error(`Missing required header: ${r}`);return n};var hv,gv,sp,r4,W=class{constructor({baseURL:e=gn("OPENAI_BASE_URL"),apiKey:r=gn("OPENAI_API_KEY"),organization:n=gn("OPENAI_ORG_ID")??null,project:i=gn("OPENAI_PROJECT_ID")??null,webhookSecret:s=gn("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(hv.add(this),sp.set(this,void 0),this.completions=new _i(this),this.chat=new fn(this),this.embeddings=new ki(this),this.files=new Ei(this),this.images=new Ii(this),this.audio=new vr(this),this.moderations=new Ni(this),this.models=new Oi(this),this.fineTuning=new Gt(this),this.graders=new wn(this),this.vectorStores=new Fr(this),this.webhooks=new ji(this),this.beta=new Wt(this),this.batches=new vi(this),this.uploads=new Sn(this),this.responses=new Dr(this),this.realtime=new $r(this),this.conversations=new xn(this),this.evals=new bn(this),this.containers=new yn(this),this.videos=new Ri(this),r===void 0)throw new M("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let o={apiKey:r,organization:n,project:i,webhookSecret:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&lE())throw new M(`It looks like you're running in a browser-like environment.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
M [Error]: Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.
    at new W (/opt/render/project/src/dist/index.cjs:73:44267)
    at Object.<anonymous> (/opt/render/project/src/dist/index.cjs:82:9571)
    at Module._compile (node:internal/modules/cjs/loader:1730:14)
    at Object..js (node:internal/modules/cjs/loader:1895:10)
    at Module.load (node:internal/modules/cjs/loader:1465:32)
    at Function._load (node:internal/modules/cjs/loader:1282:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:171:5)
    at node:internal/main/run_main_module:36:49
Node.js v22.16.0
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
error Command failed with exit code 1.
==> Exited with status 1
==> Common ways to troubleshoot your deploy: https://render.com/docs/troubleshooting-deploys
==> Running 'yarn start'
yarn run v1.22.22
$ NODE_ENV=production node dist/index.cjs
/opt/render/project/src/dist/index.cjs:73
${Gu(t)}`);return{...R,id:I,type:F,function:{...ne,name:Y,arguments:Q}}})}}:{...f,message:{..._,content:h,role:w,refusal:c.refusal??null},finish_reason:u,index:p,logprobs:d}}),created:i,model:s,object:"chat.completion",...a?{system_fingerprint:a}:{}};return OE(l,e)}function Gu(t){return JSON.stringify(t)}var yc=class t extends gi{static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static runTools(e,r,n){let i=new t(r),s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,r,s)),i}};var qr=class extends A{constructor(){super(...arguments),this.messages=new mi(this._client)}create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}retrieve(e,r){return this._client.get(S`/chat/completions/${e}`,r)}update(e,r,n){return this._client.post(S`/chat/completions/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/chat/completions",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/chat/completions/${e}`,r)}parse(e,r){return jE(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>dc(n,e))}runTools(e,r){return e.stream?yc.runTools(this._client,e,r):vc.runTools(this._client,e,r)}stream(e,r){return gi.createChatCompletion(this._client,e,r)}};qr.Messages=mi;var fn=class extends A{constructor(){super(...arguments),this.completions=new qr(this._client)}};fn.Completions=qr;var BE=Symbol("brand.privateNullableHeaders");function*P$(t){if(!t)return;if(BE in t){let{values:n,nulls:i}=t;yield*n.entries();for(let s of i)yield[s,null];return}let e=!1,r;t instanceof Headers?r=t.entries():Rg(t)?r=t:(e=!0,r=Object.entries(t??{}));for(let n of r){let i=n[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");let s=Rg(n[1])?n[1]:[n[1]],a=!1;for(let o of s)o!==void 0&&(e&&!a&&(a=!0,yield[i,null]),yield[i,o])}}var O=t=>{let e=new Headers,r=new Set;for(let n of t){let i=new Set;for(let[s,a]of P$(n)){let o=s.toLowerCase();i.has(o)||(e.delete(s),i.add(o)),a===null?(e.delete(s),r.add(o)):(e.append(s,a),r.delete(o))}}return{[BE]:!0,values:e,nulls:r}};var na=class extends A{create(e,r){return this._client.post("/audio/speech",{body:e,...r,headers:O([{Accept:"application/octet-stream"},r?.headers]),__binaryResponse:!0})}};var ia=class extends A{create(e,r){return this._client.post("/audio/transcriptions",Ct({body:e,...r,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};var sa=class extends A{create(e,r){return this._client.post("/audio/translations",Ct({body:e,...r,__metadata:{model:e.model}},this._client))}};var vr=class extends A{constructor(){super(...arguments),this.transcriptions=new ia(this._client),this.translations=new sa(this._client),this.speech=new na(this._client)}};vr.Transcriptions=ia;vr.Translations=sa;vr.Speech=na;var vi=class extends A{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(S`/batches/${e}`,r)}list(e={},r){return this._client.getAPIList("/batches",X,{query:e,...r})}cancel(e,r){return this._client.post(S`/batches/${e}/cancel`,r)}};var aa=class extends A{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(S`/assistants/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(S`/assistants/${e}`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/assistants",X,{query:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(S`/assistants/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var oa=class extends A{create(e,r){return this._client.post("/realtime/sessions",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var ca=class extends A{create(e,r){return this._client.post("/realtime/transcription_sessions",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var mn=class extends A{constructor(){super(...arguments),this.sessions=new oa(this._client),this.transcriptionSessions=new ca(this._client)}};mn.Sessions=oa;mn.TranscriptionSessions=ca;var la=class extends A{create(e,r){return this._client.post("/chatkit/sessions",{body:e,...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}cancel(e,r){return this._client.post(S`/chatkit/sessions/${e}/cancel`,{...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}};var ua=class extends A{retrieve(e,r){return this._client.get(S`/chatkit/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}list(e={},r){return this._client.getAPIList("/chatkit/threads",Nr,{query:e,...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}delete(e,r){return this._client.delete(S`/chatkit/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}listItems(e,r={},n){return this._client.getAPIList(S`/chatkit/threads/${e}/items`,Nr,{query:r,...n,headers:O([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}};var hn=class extends A{constructor(){super(...arguments),this.sessions=new la(this._client),this.threads=new ua(this._client)}};hn.Sessions=la;hn.Threads=ua;var pa=class extends A{create(e,r,n){return this._client.post(S`/threads/${e}/messages`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{thread_id:i}=r;return this._client.get(S`/threads/${i}/messages/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:i,...s}=r;return this._client.post(S`/threads/${i}/messages/${e}`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(S`/threads/${e}/messages`,X,{query:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{thread_id:i}=r;return this._client.delete(S`/threads/${i}/messages/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var da=class extends A{retrieve(e,r,n){let{thread_id:i,run_id:s,...a}=r;return this._client.get(S`/threads/${i}/runs/${s}/steps/${e}`,{query:a,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r,n){let{thread_id:i,...s}=r;return this._client.getAPIList(S`/threads/${i}/runs/${e}/steps`,X,{query:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var LE=t=>{if(typeof Buffer<"u"){let e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(t),r=e.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e.charCodeAt(i);return Array.from(new Float32Array(n.buffer))}};var gn=t=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[t]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(t)?.trim()};var Je,xi,fv,yr,Ju,Vt,bi,fa,yi,Yu,Tt,Xu,Zu,wc,xc,bc,zE,UE,QE,HE,KE,VE,WE,Mr=class extends pn{constructor(){super(...arguments),Je.add(this),fv.set(this,[]),yr.set(this,{}),Ju.set(this,{}),Vt.set(this,void 0),bi.set(this,void 0),fa.set(this,void 0),yi.set(this,void 0),Yu.set(this,void 0),Tt.set(this,void 0),Xu.set(this,void 0),Zu.set(this,void 0),wc.set(this,void 0)}[(fv=new WeakMap,yr=new WeakMap,Ju=new WeakMap,Vt=new WeakMap,bi=new WeakMap,fa=new WeakMap,yi=new WeakMap,Yu=new WeakMap,Tt=new WeakMap,Xu=new WeakMap,Zu=new WeakMap,wc=new WeakMap,Je=new WeakSet,Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",i=>{let s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,a)=>r.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let r=new xi;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let i=hr.fromReadableStream(e,this.controller);for await(let s of i)b(this,Je,"m",xc).call(this,s);if(i.controller.signal?.aborted)throw new $e;return this._addRun(b(this,Je,"m",bc).call(this))}toReadableStream(){return new hr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,i){let s=new xi;return s._run(()=>s._runToolAssistantStream(e,r,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(e,r,n,i){let s=i?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.submitToolOutputs(r,a,{...i,signal:this.controller.signal});this._connected();for await(let l of o)b(this,Je,"m",xc).call(this,l);if(o.controller.signal?.aborted)throw new $e;return this._addRun(b(this,Je,"m",bc).call(this))}static createThreadAssistantStream(e,r,n){let i=new xi;return i._run(()=>i._threadAssistantStream(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,r,n,i){let s=new xi;return s._run(()=>s._runAssistantStream(e,r,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return b(this,Xu,"f")}currentRun(){return b(this,Zu,"f")}currentMessageSnapshot(){return b(this,Vt,"f")}currentRunStepSnapshot(){return b(this,wc,"f")}async finalRunSteps(){return await this.done(),Object.values(b(this,yr,"f"))}async finalMessages(){return await this.done(),Object.values(b(this,Ju,"f"))}async finalRun(){if(await this.done(),!b(this,bi,"f"))throw Error("Final run was not received.");return b(this,bi,"f")}async _createThreadAssistantStream(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let s={...r,stream:!0},a=await e.createAndRun(s,{...n,signal:this.controller.signal});this._connected();for await(let o of a)b(this,Je,"m",xc).call(this,o);if(a.controller.signal?.aborted)throw new $e;return this._addRun(b(this,Je,"m",bc).call(this))}async _createAssistantStream(e,r,n,i){let s=i?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(r,a,{...i,signal:this.controller.signal});this._connected();for await(let l of o)b(this,Je,"m",xc).call(this,l);if(o.controller.signal?.aborted)throw new $e;return this._addRun(b(this,Je,"m",bc).call(this))}static accumulateDelta(e,r){for(let[n,i]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=i;continue}let s=e[n];if(s==null){e[n]=i;continue}if(n==="index"||n==="type"){e[n]=i;continue}if(typeof s=="string"&&typeof i=="string")s+=i;else if(typeof s=="number"&&typeof i=="number")s+=i;else if(nc(s)&&nc(i))s=this.accumulateDelta(s,i);else if(Array.isArray(s)&&Array.isArray(i)){if(s.every(a=>typeof a=="string"||typeof a=="number")){s.push(...i);continue}for(let a of i){if(!nc(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let l=s[o];l==null?s.push(a):s[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${i}, accValue: ${s}`);e[n]=s}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,i){return await this._createAssistantStream(r,e,n,i)}async _runToolAssistantStream(e,r,n,i){return await this._createToolAssistantStream(r,e,n,i)}};xi=Mr,xc=function(e){if(!this.ended)switch(U(this,Xu,e,"f"),b(this,Je,"m",QE).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":b(this,Je,"m",WE).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":b(this,Je,"m",UE).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":b(this,Je,"m",zE).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},bc=function(){if(this.ended)throw new M("stream has ended, this shouldn't happen");if(!b(this,bi,"f"))throw Error("Final run has not been received");return b(this,bi,"f")},zE=function(e){let[r,n]=b(this,Je,"m",KE).call(this,e,b(this,Vt,"f"));U(this,Vt,r,"f"),b(this,Ju,"f")[r.id]=r;for(let i of n){let s=r.content[i.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(let i of e.data.delta.content){if(i.type=="text"&&i.text){let s=i.text,a=r.content[i.index];if(a&&a.type=="text")this._emit("textDelta",s,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=b(this,fa,"f")){if(b(this,yi,"f"))switch(b(this,yi,"f").type){case"text":this._emit("textDone",b(this,yi,"f").text,b(this,Vt,"f"));break;case"image_file":this._emit("imageFileDone",b(this,yi,"f").image_file,b(this,Vt,"f"));break}U(this,fa,i.index,"f")}U(this,yi,r.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(b(this,fa,"f")!==void 0){let i=e.data.content[b(this,fa,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,b(this,Vt,"f"));break;case"text":this._emit("textDone",i.text,b(this,Vt,"f"));break}}b(this,Vt,"f")&&this._emit("messageDone",e.data),U(this,Vt,void 0,"f")}},UE=function(e){let r=b(this,Je,"m",HE).call(this,e);switch(U(this,wc,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(let s of n.step_details.tool_calls)s.index==b(this,Yu,"f")?this._emit("toolCallDelta",s,r.step_details.tool_calls[s.index]):(b(this,Tt,"f")&&this._emit("toolCallDone",b(this,Tt,"f")),U(this,Yu,s.index,"f"),U(this,Tt,r.step_details.tool_calls[s.index],"f"),b(this,Tt,"f")&&this._emit("toolCallCreated",b(this,Tt,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":U(this,wc,void 0,"f"),e.data.step_details.type=="tool_calls"&&b(this,Tt,"f")&&(this._emit("toolCallDone",b(this,Tt,"f")),U(this,Tt,void 0,"f")),this._emit("runStepDone",e.data,r);break;case"thread.run.step.in_progress":break}},QE=function(e){b(this,fv,"f").push(e),this._emit("event",e)},HE=function(e){switch(e.event){case"thread.run.step.created":return b(this,yr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=b(this,yr,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let i=xi.accumulateDelta(r,n.delta);b(this,yr,"f")[e.data.id]=i}return b(this,yr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":b(this,yr,"f")[e.data.id]=e.data;break}if(b(this,yr,"f")[e.data.id])return b(this,yr,"f")[e.data.id];throw new Error("No snapshot available")},KE=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(let s of i.delta.content)if(s.index in r.content){let a=r.content[s.index];r.content[s.index]=b(this,Je,"m",VE).call(this,s,a)}else r.content[s.index]=s,n.push(s);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},VE=function(e,r){return xi.accumulateDelta(r,e)},WE=function(e){switch(U(this,Zu,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":U(this,bi,e.data,"f"),b(this,Tt,"f")&&(this._emit("toolCallDone",b(this,Tt,"f")),U(this,Tt,void 0,"f"));break;case"thread.run.cancelling":break}};var wi=class extends A{constructor(){super(...arguments),this.steps=new da(this._client)}create(e,r,n){let{include:i,...s}=r;return this._client.post(S`/threads/${e}/runs`,{query:{include:i},body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}retrieve(e,r,n){let{thread_id:i}=r;return this._client.get(S`/threads/${i}/runs/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:i,...s}=r;return this._client.post(S`/threads/${i}/runs/${e}`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(S`/threads/${e}/runs`,X,{query:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{thread_id:i}=r;return this._client.post(S`/threads/${i}/runs/${e}/cancel`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r,n);return await this.poll(i.id,{thread_id:e},n)}createAndStream(e,r,n){return Mr.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){let i=O([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:a}=await this.retrieve(e,r,{...n,headers:{...n?.headers,...i}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await fr(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,r,n){return Mr.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n){let{thread_id:i,...s}=r;return this._client.post(S`/threads/${i}/runs/${e}/submit_tool_outputs`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}async submitToolOutputsAndPoll(e,r,n){let i=await this.submitToolOutputs(e,r,n);return await this.poll(i.id,r,n)}submitToolOutputsStream(e,r,n){return Mr.createToolAssistantStream(e,this._client.beta.threads.runs,r,n)}};wi.Steps=da;var vn=class extends A{constructor(){super(...arguments),this.runs=new wi(this._client),this.messages=new pa(this._client)}create(e={},r){return this._client.post("/threads",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(S`/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(S`/threads/${e}`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r){return this._client.delete(S`/threads/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,r){let n=await this.createAndRun(e,r);return await this.runs.poll(n.id,{thread_id:n.thread_id},r)}createAndRunStream(e,r){return Mr.createThreadAssistantStream(e,this._client.beta.threads,r)}};vn.Runs=wi;vn.Messages=pa;var Wt=class extends A{constructor(){super(...arguments),this.realtime=new mn(this._client),this.chatkit=new hn(this._client),this.assistants=new aa(this._client),this.threads=new vn(this._client)}};Wt.Realtime=mn;Wt.ChatKit=hn;Wt.Assistants=aa;Wt.Threads=vn;var _i=class extends A{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}};var ma=class extends A{retrieve(e,r,n){let{container_id:i}=r;return this._client.get(S`/containers/${i}/files/${e}/content`,{...n,headers:O([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}};var Si=class extends A{constructor(){super(...arguments),this.content=new ma(this._client)}create(e,r,n){return this._client.post(S`/containers/${e}/files`,Ct({body:r,...n},this._client))}retrieve(e,r,n){let{container_id:i}=r;return this._client.get(S`/containers/${i}/files/${e}`,n)}list(e,r={},n){return this._client.getAPIList(S`/containers/${e}/files`,X,{query:r,...n})}delete(e,r,n){let{container_id:i}=r;return this._client.delete(S`/containers/${i}/files/${e}`,{...n,headers:O([{Accept:"*/*"},n?.headers])})}};Si.Content=ma;var yn=class extends A{constructor(){super(...arguments),this.files=new Si(this._client)}create(e,r){return this._client.post("/containers",{body:e,...r})}retrieve(e,r){return this._client.get(S`/containers/${e}`,r)}list(e={},r){return this._client.getAPIList("/containers",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/containers/${e}`,{...r,headers:O([{Accept:"*/*"},r?.headers])})}};yn.Files=Si;var ha=class extends A{create(e,r,n){let{include:i,...s}=r;return this._client.post(S`/conversations/${e}/items`,{query:{include:i},body:s,...n})}retrieve(e,r,n){let{conversation_id:i,...s}=r;return this._client.get(S`/conversations/${i}/items/${e}`,{query:s,...n})}list(e,r={},n){return this._client.getAPIList(S`/conversations/${e}/items`,Nr,{query:r,...n})}delete(e,r,n){let{conversation_id:i}=r;return this._client.delete(S`/conversations/${i}/items/${e}`,n)}};var xn=class extends A{constructor(){super(...arguments),this.items=new ha(this._client)}create(e={},r){return this._client.post("/conversations",{body:e,...r})}retrieve(e,r){return this._client.get(S`/conversations/${e}`,r)}update(e,r,n){return this._client.post(S`/conversations/${e}`,{body:r,...n})}delete(e,r){return this._client.delete(S`/conversations/${e}`,r)}};xn.Items=ha;var ki=class extends A{create(e,r){let n=!!e.encoding_format,i=n?e.encoding_format:"base64";n&&Re(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let s=this._client.post("/embeddings",{body:{...e,encoding_format:i},...r});return n?s:(Re(this._client).debug("embeddings/decoding base64 embeddings from base64"),s._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{let l=o.embedding;o.embedding=LE(l)}),a)))}};var ga=class extends A{retrieve(e,r,n){let{eval_id:i,run_id:s}=r;return this._client.get(S`/evals/${i}/runs/${s}/output_items/${e}`,n)}list(e,r,n){let{eval_id:i,...s}=r;return this._client.getAPIList(S`/evals/${i}/runs/${e}/output_items`,X,{query:s,...n})}};var Ai=class extends A{constructor(){super(...arguments),this.outputItems=new ga(this._client)}create(e,r,n){return this._client.post(S`/evals/${e}/runs`,{body:r,...n})}retrieve(e,r,n){let{eval_id:i}=r;return this._client.get(S`/evals/${i}/runs/${e}`,n)}list(e,r={},n){return this._client.getAPIList(S`/evals/${e}/runs`,X,{query:r,...n})}delete(e,r,n){let{eval_id:i}=r;return this._client.delete(S`/evals/${i}/runs/${e}`,n)}cancel(e,r,n){let{eval_id:i}=r;return this._client.post(S`/evals/${i}/runs/${e}`,n)}};Ai.OutputItems=ga;var bn=class extends A{constructor(){super(...arguments),this.runs=new Ai(this._client)}create(e,r){return this._client.post("/evals",{body:e,...r})}retrieve(e,r){return this._client.get(S`/evals/${e}`,r)}update(e,r,n){return this._client.post(S`/evals/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/evals",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/evals/${e}`,r)}};bn.Runs=Ai;var Ei=class extends A{create(e,r){return this._client.post("/files",Ct({body:e,...r},this._client))}retrieve(e,r){return this._client.get(S`/files/${e}`,r)}list(e={},r){return this._client.getAPIList("/files",X,{query:e,...r})}delete(e,r){return this._client.delete(S`/files/${e}`,r)}content(e,r){return this._client.get(S`/files/${e}/content`,{...r,headers:O([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=1800*1e3}={}){let i=new Set(["processed","error","deleted"]),s=Date.now(),a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await fr(r),a=await this.retrieve(e),Date.now()-s>n)throw new ln({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}};var va=class extends A{};var ya=class extends A{run(e,r){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...r})}validate(e,r){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...r})}};var Ci=class extends A{constructor(){super(...arguments),this.graders=new ya(this._client)}};Ci.Graders=ya;var xa=class extends A{create(e,r,n){return this._client.getAPIList(S`/fine_tuning/checkpoints/${e}/permissions`,gr,{body:r,method:"post",...n})}retrieve(e,r={},n){return this._client.get(S`/fine_tuning/checkpoints/${e}/permissions`,{query:r,...n})}delete(e,r,n){let{fine_tuned_model_checkpoint:i}=r;return this._client.delete(S`/fine_tuning/checkpoints/${i}/permissions/${e}`,n)}};var Ti=class extends A{constructor(){super(...arguments),this.permissions=new xa(this._client)}};Ti.Permissions=xa;var ba=class extends A{list(e,r={},n){return this._client.getAPIList(S`/fine_tuning/jobs/${e}/checkpoints`,X,{query:r,...n})}};var Pi=class extends A{constructor(){super(...arguments),this.checkpoints=new ba(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(S`/fine_tuning/jobs/${e}`,r)}list(e={},r){return this._client.getAPIList("/fine_tuning/jobs",X,{query:e,...r})}cancel(e,r){return this._client.post(S`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return this._client.getAPIList(S`/fine_tuning/jobs/${e}/events`,X,{query:r,...n})}pause(e,r){return this._client.post(S`/fine_tuning/jobs/${e}/pause`,r)}resume(e,r){return this._client.post(S`/fine_tuning/jobs/${e}/resume`,r)}};Pi.Checkpoints=ba;var Gt=class extends A{constructor(){super(...arguments),this.methods=new va(this._client),this.jobs=new Pi(this._client),this.checkpoints=new Ti(this._client),this.alpha=new Ci(this._client)}};Gt.Methods=va;Gt.Jobs=Pi;Gt.Checkpoints=Ti;Gt.Alpha=Ci;var wa=class extends A{};var wn=class extends A{constructor(){super(...arguments),this.graderModels=new wa(this._client)}};wn.GraderModels=wa;var Ii=class extends A{createVariation(e,r){return this._client.post("/images/variations",Ct({body:e,...r},this._client))}edit(e,r){return this._client.post("/images/edits",Ct({body:e,...r,stream:e.stream??!1},this._client))}generate(e,r){return this._client.post("/images/generations",{body:e,...r,stream:e.stream??!1})}};var Oi=class extends A{retrieve(e,r){return this._client.get(S`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",gr,e)}delete(e,r){return this._client.delete(S`/models/${e}`,r)}};var Ni=class extends A{create(e,r){return this._client.post("/moderations",{body:e,...r})}};var _a=class extends A{accept(e,r,n){return this._client.post(S`/realtime/calls/${e}/accept`,{body:r,...n,headers:O([{Accept:"*/*"},n?.headers])})}hangup(e,r){return this._client.post(S`/realtime/calls/${e}/hangup`,{...r,headers:O([{Accept:"*/*"},r?.headers])})}refer(e,r,n){return this._client.post(S`/realtime/calls/${e}/refer`,{body:r,...n,headers:O([{Accept:"*/*"},n?.headers])})}reject(e,r={},n){return this._client.post(S`/realtime/calls/${e}/reject`,{body:r,...n,headers:O([{Accept:"*/*"},n?.headers])})}};var Sa=class extends A{create(e,r){return this._client.post("/realtime/client_secrets",{body:e,...r})}};var $r=class extends A{constructor(){super(...arguments),this.clientSecrets=new Sa(this._client),this.calls=new _a(this._client)}};$r.ClientSecrets=Sa;$r.Calls=_a;function GE(t,e){return!e||!aD(e)?{...t,output_parsed:null,output:t.output.map(r=>r.type==="function_call"?{...r,parsed_arguments:null}:r.type==="message"?{...r,content:r.content.map(n=>({...n,parsed:null}))}:r)}:mv(t,e)}function mv(t,e){let r=t.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:lD(e,i)};if(i.type==="message"){let s=i.content.map(a=>a.type==="output_text"?{...a,parsed:sD(e,a.text)}:a);return{...i,content:s}}return i}),n=Object.assign({},t,{output:r});return Object.getOwnPropertyDescriptor(t,"output_text")||ep(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let i of n.output)if(i.type==="message"){for(let s of i.content)if(s.type==="output_text"&&s.parsed!==null)return s.parsed}return null}}),n}function sD(t,e){return t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(e):JSON.parse(e)}function aD(t){return!!pc(t.text?.format)}function oD(t){return t?.$brand==="auto-parseable-tool"}function cD(t,e){return t.find(r=>r.type==="function"&&r.name===e)}function lD(t,e){let r=cD(t.tools??[],e.name);return{...e,...e,parsed_arguments:oD(r)?r.$parseRaw(e.arguments):r?.strict?JSON.parse(e.arguments):null}}function ep(t){let e=[];for(let r of t.output)if(r.type==="message")for(let n of r.content)n.type==="output_text"&&e.push(n.text);t.output_text=e.join("")}var ka,tp,_n,rp,JE,XE,ZE,YE,np=class t extends pn{constructor(e){super(),ka.add(this),tp.set(this,void 0),_n.set(this,void 0),rp.set(this,void 0),U(this,tp,e,"f")}static createResponse(e,r,n){let i=new t(r);return i._run(()=>i._createOrRetrieveResponse(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),b(this,ka,"m",JE).call(this);let s,a=null;"response_id"in r?(s=await e.responses.retrieve(r.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=r.starting_after??null):s=await e.responses.create({...r,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let o of s)b(this,ka,"m",XE).call(this,o,a);if(s.controller.signal?.aborted)throw new $e;return b(this,ka,"m",ZE).call(this)}[(tp=new WeakMap,_n=new WeakMap,rp=new WeakMap,ka=new WeakSet,JE=function(){this.ended||U(this,_n,void 0,"f")},XE=function(r,n){if(this.ended)return;let i=(a,o)=>{(n==null||o.sequence_number>n)&&this._emit(a,o)},s=b(this,ka,"m",YE).call(this,r);switch(i("event",r),r.type){case"response.output_text.delta":{let a=s.output[r.output_index];if(!a)throw new M(`missing output at index ${r.output_index}`);if(a.type==="message"){let o=a.content[r.content_index];if(!o)throw new M(`missing content at index ${r.content_index}`);if(o.type!=="output_text")throw new M(`expected content to be 'output_text', got ${o.type}`);i("response.output_text.delta",{...r,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let a=s.output[r.output_index];if(!a)throw new M(`missing output at index ${r.output_index}`);a.type==="function_call"&&i("response.function_call_arguments.delta",{...r,snapshot:a.arguments});break}default:i(r.type,r);break}},ZE=function(){if(this.ended)throw new M("stream has ended, this shouldn't happen");let r=b(this,_n,"f");if(!r)throw new M("request ended without sending any events");U(this,_n,void 0,"f");let n=uD(r,b(this,tp,"f"));return U(this,rp,n,"f"),n},YE=function(r){let n=b(this,_n,"f");if(!n){if(r.type!=="response.created")throw new M(`When snapshot hasn't been set yet, expected 'response.created' event, got ${r.type}`);return n=U(this,_n,r.response,"f"),n}switch(r.type){case"response.output_item.added":{n.output.push(r.item);break}case"response.content_part.added":{let i=n.output[r.output_index];if(!i)throw new M(`missing output at index ${r.output_index}`);let s=i.type,a=r.part;s==="message"&&a.type!=="reasoning_text"?i.content.push(a):s==="reasoning"&&a.type==="reasoning_text"&&(i.content||(i.content=[]),i.content.push(a));break}case"response.output_text.delta":{let i=n.output[r.output_index];if(!i)throw new M(`missing output at index ${r.output_index}`);if(i.type==="message"){let s=i.content[r.content_index];if(!s)throw new M(`missing content at index ${r.content_index}`);if(s.type!=="output_text")throw new M(`expected content to be 'output_text', got ${s.type}`);s.text+=r.delta}break}case"response.function_call_arguments.delta":{let i=n.output[r.output_index];if(!i)throw new M(`missing output at index ${r.output_index}`);i.type==="function_call"&&(i.arguments+=r.delta);break}case"response.reasoning_text.delta":{let i=n.output[r.output_index];if(!i)throw new M(`missing output at index ${r.output_index}`);if(i.type==="reasoning"){let s=i.content?.[r.content_index];if(!s)throw new M(`missing content at index ${r.content_index}`);if(s.type!=="reasoning_text")throw new M(`expected content to be 'reasoning_text', got ${s.type}`);s.text+=r.delta}break}case"response.completed":{U(this,_n,r.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",i=>{let s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,a)=>r.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=b(this,rp,"f");if(!e)throw new M("stream ended without producing a ChatCompletion");return e}};function uD(t,e){return GE(t,e)}var Aa=class extends A{list(e,r={},n){return this._client.getAPIList(S`/responses/${e}/input_items`,X,{query:r,...n})}};var Ea=class extends A{count(e={},r){return this._client.post("/responses/input_tokens",{body:e,...r})}};var Dr=class extends A{constructor(){super(...arguments),this.inputItems=new Aa(this._client),this.inputTokens=new Ea(this._client)}create(e,r){return this._client.post("/responses",{body:e,...r,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&ep(n),n))}retrieve(e,r={},n){return this._client.get(S`/responses/${e}`,{query:r,...n,stream:r?.stream??!1})._thenUnwrap(i=>("object"in i&&i.object==="response"&&ep(i),i))}delete(e,r){return this._client.delete(S`/responses/${e}`,{...r,headers:O([{Accept:"*/*"},r?.headers])})}parse(e,r){return this._client.responses.create(e,r)._thenUnwrap(n=>mv(n,e))}stream(e,r){return np.createResponse(this._client,e,r)}cancel(e,r){return this._client.post(S`/responses/${e}/cancel`,r)}compact(e,r){return this._client.post("/responses/compact",{body:e,...r})}};Dr.InputItems=Aa;Dr.InputTokens=Ea;var Ca=class extends A{create(e,r,n){return this._client.post(S`/uploads/${e}/parts`,Ct({body:r,...n},this._client))}};var Sn=class extends A{constructor(){super(...arguments),this.parts=new Ca(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(S`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(S`/uploads/${e}/complete`,{body:r,...n})}};Sn.Parts=Ca;var e4=async t=>{let e=await Promise.allSettled(t),r=e.filter(i=>i.status==="rejected");if(r.length){for(let i of r)console.error(i.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let i of e)i.status==="fulfilled"&&n.push(i.value);return n};var Ta=class extends A{create(e,r,n){return this._client.post(S`/vector_stores/${e}/file_batches`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:i}=r;return this._client.get(S`/vector_stores/${i}/file_batches/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{vector_store_id:i}=r;return this._client.post(S`/vector_stores/${i}/file_batches/${e}/cancel`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r);return await this.poll(e,i.id,n)}listFiles(e,r,n){let{vector_store_id:i,...s}=r;return this._client.getAPIList(S`/vector_stores/${i}/file_batches/${e}/files`,X,{query:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,r,n){let i=O([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:a}=await this.retrieve(r,{vector_store_id:e},{...n,headers:i}).withResponse();switch(s.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await fr(o);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},i){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let s=i?.maxConcurrency??5,a=Math.min(s,r.length),o=this._client,l=r.values(),c=[...n];async function u(d){for(let f of d){let h=await o.files.create({file:f,purpose:"assistants"},i);c.push(h.id)}}let p=Array(a).fill(l).map(u);return await e4(p),await this.createAndPoll(e,{file_ids:c})}};var Pa=class extends A{create(e,r,n){return this._client.post(S`/vector_stores/${e}/files`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:i}=r;return this._client.get(S`/vector_stores/${i}/files/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{vector_store_id:i,...s}=r;return this._client.post(S`/vector_stores/${i}/files/${e}`,{body:s,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(S`/vector_stores/${e}/files`,X,{query:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{vector_store_id:i}=r;return this._client.delete(S`/vector_stores/${i}/files/${e}`,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r,n);return await this.poll(e,i.id,n)}async poll(e,r,n){let i=O([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let s=await this.retrieve(r,{vector_store_id:e},{...n,headers:i}).withResponse(),a=s.data;switch(a.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let l=s.response.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await fr(o);break;case"failed":case"completed":return a}}}async upload(e,r,n){let i=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:i.id},n)}async uploadAndPoll(e,r,n){let i=await this.upload(e,r,n);return await this.poll(e,i.id,n)}content(e,r,n){let{vector_store_id:i}=r;return this._client.getAPIList(S`/vector_stores/${i}/files/${e}/content`,gr,{...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var Fr=class extends A{constructor(){super(...arguments),this.files=new Pa(this._client),this.fileBatches=new Ta(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(S`/vector_stores/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(S`/vector_stores/${e}`,{body:r,...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/vector_stores",X,{query:e,...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(S`/vector_stores/${e}`,{...r,headers:O([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}search(e,r,n){return this._client.getAPIList(S`/vector_stores/${e}/search`,gr,{body:r,method:"post",...n,headers:O([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};Fr.Files=Pa;Fr.FileBatches=Ta;var Ri=class extends A{create(e,r){return this._client.post("/videos",Jg({body:e,...r},this._client))}retrieve(e,r){return this._client.get(S`/videos/${e}`,r)}list(e={},r){return this._client.getAPIList("/videos",Nr,{query:e,...r})}delete(e,r){return this._client.delete(S`/videos/${e}`,r)}downloadContent(e,r={},n){return this._client.get(S`/videos/${e}/content`,{query:r,...n,headers:O([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(e,r,n){return this._client.post(S`/videos/${e}/remix`,Jg({body:r,...n},this._client))}};var Ia,t4,ip,ji=class extends A{constructor(){super(...arguments),Ia.add(this)}async unwrap(e,r,n=this._client.webhookSecret,i=300){return await this.verifySignature(e,r,n,i),JSON.parse(e)}async verifySignature(e,r,n=this._client.webhookSecret,i=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");b(this,Ia,"m",t4).call(this,n);let s=O([r]).values,a=b(this,Ia,"m",ip).call(this,s,"webhook-signature"),o=b(this,Ia,"m",ip).call(this,s,"webhook-timestamp"),l=b(this,Ia,"m",ip).call(this,s,"webhook-id"),c=parseInt(o,10);if(isNaN(c))throw new dr("Invalid webhook timestamp format");let u=Math.floor(Date.now()/1e3);if(u-c>i)throw new dr("Webhook timestamp is too old");if(c>u+i)throw new dr("Webhook timestamp is too new");let p=a.split(" ").map(m=>m.startsWith("v1,")?m.substring(3):m),d=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),f=l?`${l}.${o}.${e}`:`${o}.${e}`,h=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let m of p)try{let x=Buffer.from(m,"base64");if(await crypto.subtle.verify("HMAC",h,x,new TextEncoder().encode(f)))return}catch{continue}throw new dr("The given webhook signature does not match the expected signature")}};Ia=new WeakSet,t4=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},ip=function(e,r){if(!e)throw new Error("Headers are required");let n=e.get(r);if(n==null)throw new Error(`Missing required header: ${r}`);return n};var hv,gv,sp,r4,W=class{constructor({baseURL:e=gn("OPENAI_BASE_URL"),apiKey:r=gn("OPENAI_API_KEY"),organization:n=gn("OPENAI_ORG_ID")??null,project:i=gn("OPENAI_PROJECT_ID")??null,webhookSecret:s=gn("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(hv.add(this),sp.set(this,void 0),this.completions=new _i(this),this.chat=new fn(this),this.embeddings=new ki(this),this.files=new Ei(this),this.images=new Ii(this),this.audio=new vr(this),this.moderations=new Ni(this),this.models=new Oi(this),this.fineTuning=new Gt(this),this.graders=new wn(this),this.vectorStores=new Fr(this),this.webhooks=new ji(this),this.beta=new Wt(this),this.batches=new vi(this),this.uploads=new Sn(this),this.responses=new Dr(this),this.realtime=new $r(this),this.conversations=new xn(this),this.evals=new bn(this),this.containers=new yn(this),this.videos=new Ri(this),r===void 0)throw new M("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let o={apiKey:r,organization:n,project:i,webhookSecret:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&lE())throw new M(`It looks like you're running in a browser-like environment.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
M [Error]: Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.
    at new W (/opt/render/project/src/dist/index.cjs:73:44267)
    at Object.<anonymous> (/opt/render/project/src/dist/index.cjs:82:9571)
    at Module._compile (node:internal/modules/cjs/loader:1730:14)
    at Object..js (node:internal/modules/cjs/loader:1895:10)
    at Module.load (node:internal/modules/cjs/loader:1465:32)
    at Function._load (node:internal/modules/cjs/loader:1282:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:171:5)
    at node:internal/main/run_main_module:36:49
Node.js v22.16.0
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.